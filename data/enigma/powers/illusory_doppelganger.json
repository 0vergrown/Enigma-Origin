{
   "name":"Illusory Doppelganger",
   "description":"Summon a deceptive clone in your stead as you meld into invisibility. An explosion of dark energy ensues if either of you is struck, revealing your form and annihilating the clone. Voluntarily dispel the clone with a mere thought.",
   "type":"origins:multiple",
   "clone_set":{
      "type":"origins:entity_set",
      "action_on_add":{
         "type":"origins:target_action",
         "action":{
            "type":"origins:grant_power",
            "power":"enigma:illusory_doppelganger_clone_detect_hit",
            "source":"enigma:enigma"
         }
      },
      "action_on_remove":{
         "type":"origins:target_action",
         "action":{
            "type":"origins:and",
            "actions":[
               {
                  "type":"origins:revoke_power",
                  "power":"enigma:illusory_doppelganger_clone_detect_hit",
                  "source":"enigma:enigma"
               },
               {
                  "type":"origins:delay",
                  "action":{
                     "type":"origins:grant_power",
                     "power":"enigma:illusory_doppelganger_clone_kill",
                     "source":"enigma:enigma"
                  },
                  "ticks":1
               },
               {
                  "type":"origins:execute_command",
                  "command":"forceload remove ~ ~ ~ ~"
               }
            ]
         }
      }
   },
   "trigger":{
      "type":"origins:resource",
      "min":0,
      "max":1,
      "hud_render":{
         "should_render":false
      },
      "start_value":0
   },
   "active":{
      "type":"origins:active_self",
      "entity_action":{
         "type":"origins:if_else",
         "condition":{
            "type":"origins:resource",
            "resource":"enigma:illusory_doppelganger_trigger",
            "comparison":"==",
            "compare_to":0
         },
         "if_action":{
            "type":"origins:and",
            "actions":[
               {
                  "type":"origins:play_sound",
                  "sound":"minecraft:entity.evoker.prepare_summon",
                  "volume":1.00,
                  "pitch":2.00
               },
               {
                  "type":"origins:change_resource",
                  "resource":"enigma:illusory_doppelganger_trigger",
                  "change":1,
                  "operation":"set"
               },
               {
                  "type":"origins:spawn_entity",
                  "entity_type":"minecraft:zombie",
                  "tag":"{NoAI:1b,Silent:1b}",
                  "entity_action":{
                     "type":"origins:and",
                     "actions":[
                        {
                           "type":"origins:execute_command",
                           "command":"forceload add ~ ~ ~ ~"
                        },
                        {
                           "type":"origins:execute_command",
                           "command":"tag @s add enigma_clone"
                        },
                        {
                           "type":"origins:delay",
                           "action":{
                              "type":"origins:execute_command",
                              "command":"tag @s remove enigma_clone"
                           },
                           "ticks":2
                        }
                     ]
                  },
                  "bientity_action":{
                     "type":"origins:add_to_set",
                     "set":"enigma:illusory_doppelganger_clone_set"
                  }
               },
               {
                  "type":"origins:delay",
                  "action":{
                     "type":"origins:and",
                     "actions":[
                        {
                           "type":"origins:execute_command",
                           "command":"data modify entity @e[tag=enigma_clone,limit=1,sort=nearest] ArmorItems[3] set value {Count:1b,id:\"minecraft:player_head\"}"
                        },
                        {
                           "type":"origins:execute_command",
                           "command":"item modify entity @e[tag=enigma_clone,limit=1,sort=nearest] armor.head enigma:get_head"
                        },
                        {
                           "type":"origins:execute_command",
                           "command":"data modify entity @e[tag=enigma_clone,limit=1,sort=nearest] ArmorItems[2] set from entity @s Inventory[{Slot:102b}]"
                        },
                        {
                           "type":"origins:execute_command",
                           "command":"data modify entity @e[tag=enigma_clone,limit=1,sort=nearest] ArmorItems[1] set from entity @s Inventory[{Slot:101b}]"
                        },
                        {
                           "type":"origins:execute_command",
                           "command":"data modify entity @e[tag=enigma_clone,limit=1,sort=nearest] ArmorItems[0] set from entity @s Inventory[{Slot:100b}]"
                        }
                     ]
                  },
                  "ticks":1
               }
            ]
         },
         "else_action":{
            "type":"origins:and",
            "actions":[
               {
                  "type":"origins:change_resource",
                  "resource":"enigma:illusory_doppelganger_trigger",
                  "change":0,
                  "operation":"set"
               },
               {
                  "type":"origins:action_on_set",
                  "set":"enigma:illusory_doppelganger_clone_set",
                  "bientity_action":{
                     "type":"origins:remove_from_set",
                     "set":"enigma:illusory_doppelganger_clone_set"
                  },
                  "limit":1,
                  "reverse":false
               },
               {
                  "type":"origins:play_sound",
                  "sound":"minecraft:entity.evoker.prepare_summon",
                  "volume":1.00,
                  "pitch":2.00
               }
            ]
         }
      },
      "cooldown":100,
      "hud_render":{
         "should_render":true,
         "sprite_location":"origins:textures/gui/resource_bar.png",
         "bar_index":3
      },
      "key":{
         "key":"key.origins.secondary_active",
         "continuous":false
      }
   },
   "reset_on_hit":{
      "type":"origins:self_action_when_hit",
      "entity_action":{
         "type":"origins:and",
         "actions":[
            {
               "type":"origins:change_resource",
               "resource":"enigma:illusory_doppelganger_trigger",
               "change":0,
               "operation":"set"
            },
            {
               "type":"origins:action_on_set",
               "set":"enigma:illusory_doppelganger_clone_set",
               "bientity_action":{
                  "type":"origins:remove_from_set",
                  "set":"enigma:illusory_doppelganger_clone_set"
               },
               "limit":1,
               "reverse":false
            }
         ]
      },
      "cooldown":1,
      "hud_render":{
         "should_render":false
      },
      "condition":{
         "type":"origins:resource",
         "resource":"enigma:illusory_doppelganger_trigger",
         "comparison":"==",
         "compare_to":1
      }
   },
   "invisibility":{
      "type":"origins:invisibility",
      "render_armor":false,
      "render_outline":false,
      "condition":{
         "type":"origins:resource",
         "resource":"enigma:illusory_doppelganger_trigger",
         "comparison":"==",
         "compare_to":1
      }
   }
}
